<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="AI-powered malicious content detection for Gen Z language. Analyze text for harmful content, hate speech, and harassment.">
    <meta name="keywords" content="content detection, AI, malicious content, hate speech, harassment, Gen Z">
    <meta name="author" content="ContentGuard AI">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="ContentGuard AI - Malicious Content Detector">
    <meta property="og:description" content="AI-powered malicious content detection for Gen Z language">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://contentguard-ai.com">
    <link rel="canonical" href="https://contentguard-ai.com">
    <title>ContentGuard AI - Malicious Content Detector</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/modern-neumorphic.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/explainability.css') }}">
    
    <!-- Rate Limit CSS - Inline -->
    <style>
    .rate-limit-display {
        margin: 15px 0;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 0.9rem;
        animation: slideIn 0.3s ease-out;
    }

    .cooldown-timer {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        color: #f59e0b;
        background-color: #fef3c7;
        padding: 12px;
        border-radius: 6px;
        border: 1px solid #fbbf24;
    }

    .cooldown-timer i {
        font-size: 1.2rem;
    }

    .cooldown-timer span {
        text-align: center;
    }

    .cooldown-timer strong {
        font-weight: 600;
        color: #d97706;
    }

    .cooldown-timer small {
        font-size: 0.8rem;
        opacity: 0.8;
        margin-top: 4px;
    }

    .rate-limit-info {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #3b82f6;
        background-color: #dbeafe;
        padding: 10px 14px;
        border-radius: 6px;
        border: 1px solid #93c5fd;
    }

    .rate-limit-info i {
        font-size: 1rem;
    }

    .rate-limit-info span {
        font-size: 0.85rem;
    }

    .dark .cooldown-timer {
        background-color: rgba(245, 158, 11, 0.1);
        border-color: rgba(251, 191, 36, 0.3);
        color: #fbbf24;
    }

    .dark .cooldown-timer strong {
        color: #fcd34d;
    }

    .dark .rate-limit-info {
        background-color: rgba(59, 130, 246, 0.1);
        border-color: rgba(147, 197, 253, 0.3);
        color: #93c5fd;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .error-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        justify-content: center;
    }

    .error-actions .btn {
        padding: 8px 20px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .error-actions .btn-primary {
        background-color: #3b82f6;
        color: white;
    }

    .error-actions .btn-primary:hover {
        background-color: #2563eb;
    }

    .error-actions .btn-secondary {
        background-color: #6b7280;
        color: white;
    }

    .error-actions .btn-secondary:hover {
        background-color: #4b5563;
    }

    @media (max-width: 768px) {
        .rate-limit-display {
            font-size: 0.85rem;
        }
        
        .cooldown-timer {
            padding: 10px;
        }
        
        .error-actions {
            flex-direction: column;
        }
        
        .error-actions .btn {
            width: 100%;
        }
    }
    
    /* Analysis Status Banner Styles */
    .analysis-status-banner {
        margin: 20px 0;
        padding: 16px 20px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: slideIn 0.3s ease-out;
    }
    
    .analysis-status-banner.success {
        background-color: #d1fae5;
        border: 1px solid #6ee7b7;
        color: #065f46;
    }
    
    .analysis-status-banner.warning {
        background-color: #fef3c7;
        border: 1px solid #fbbf24;
        color: #92400e;
    }
    
    .analysis-status-banner.error {
        background-color: #fee2e2;
        border: 1px solid #fca5a5;
        color: #991b1b;
    }
    
    .dark .analysis-status-banner.success {
        background-color: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.3);
        color: #6ee7b7;
    }
    
    .dark .analysis-status-banner.warning {
        background-color: rgba(245, 158, 11, 0.1);
        border-color: rgba(245, 158, 11, 0.3);
        color: #fbbf24;
    }
    
    .dark .analysis-status-banner.error {
        background-color: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
        color: #fca5a5;
    }
    
    .analysis-status-banner .icon {
        font-size: 1.5rem;
        flex-shrink: 0;
    }
    
    .analysis-status-banner .content {
        flex: 1;
    }
    
    .analysis-status-banner .title {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 4px;
    }
    
    .analysis-status-banner .message {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .analysis-status-banner .badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .analysis-status-banner .badge.batch {
        background-color: #dbeafe;
        color: #1e40af;
    }
    
    .analysis-status-banner .badge.fallback {
        background-color: #fef3c7;
        color: #92400e;
    }
    
    .dark .analysis-status-banner .badge.batch {
        background-color: rgba(59, 130, 246, 0.2);
        color: #93c5fd;
    }
    
    .dark .analysis-status-banner .badge.fallback {
        background-color: rgba(245, 158, 11, 0.2);
        color: #fbbf24;
    }
    </style>
    
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <!-- Shoelace (Web Components) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.1/cdn/themes/light.css" />
    <script type="module" src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.15.1/cdn/shoelace.js"></script>
    <!-- AOS (Animate On Scroll) -->
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
    <!-- Tippy.js (Tooltips) -->
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css" />
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <!-- Prism.js (Syntax Highlighting) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ruby.min.js"></script>
    <!-- Motion (Framer Motion) - Modern Animation Library -->
    <script src="https://cdn.jsdelivr.net/npm/motion@11.11.17/dist/motion.js"></script>
</head>
<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <div class="container">
        <header class="header" role="banner">
            <nav class="nav" role="navigation">
                <div class="nav-container">
                    <div class="logo">
                        <i class="fas fa-shield-alt" aria-hidden="true"></i>
                        <h1>ContentGuard</h1>
                    </div>
                    
                    <!-- Desktop Nav Links (hidden on mobile) -->
                    <div class="nav-links desktop-only">
                        <a href="#hero-section" class="nav-link">Home</a>
                        <a href="#main-content" class="nav-link">Analyze</a>
                        <a href="#about" class="nav-link" id="aboutLink">About</a>
                    </div>
                    
                    <!-- Right Side Actions -->
                    <div class="nav-actions">
                        <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                            <i class="fas fa-moon" aria-hidden="true"></i>
                        </button>
                        
                        <!-- Auth: Login Button (shown when not logged in) -->
                        <button class="auth-btn login-btn" id="loginBtn" style="display: none;" aria-label="Sign in">
                            <i class="fas fa-user"></i>
                            <span class="btn-text">Sign In</span>
                        </button>
                        
                        <!-- Auth: User Profile Dropdown (shown when logged in) -->
                        <sl-dropdown id="userDropdown" style="display: none;" placement="bottom-end">
                            <button slot="trigger" class="auth-btn user-btn" aria-label="User menu">
                                <img id="userAvatar" class="user-avatar" src="" alt="User avatar" />
                                <span id="userName" class="btn-text">User</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <sl-menu>
                                <sl-menu-item id="usageMenuItem" class="usage-menu-item">
                                    <div class="detailed-usage-panel">
                                        <div class="usage-header">
                                            <i class="fas fa-chart-line"></i>
                                            <span>API Usage Today</span>
                                            <span class="reset-timer" id="resetTimer">Resets in --:--:--</span>
                                        </div>
                                        
                                        <!-- HuggingFace Usage -->
                                        <div class="model-usage-section">
                                            <div class="model-header">
                                                <i class="fas fa-cpu"></i>
                                                <span class="model-name">ContentGuard Model</span>
                                            </div>
                                            <div class="usage-stats-row">
                                                <span class="usage-count">
                                                    <span id="hfUsageCount">0</span> / <span id="hfUsageLimit">200</span>
                                                </span>
                                                <span class="usage-percentage" id="hfUsagePercentage">0%</span>
                                            </div>
                                            <div class="usage-progress-bar">
                                                <div class="usage-progress-fill" id="hfProgressFill" style="width: 0%"></div>
                                            </div>
                                            <div class="usage-hint" id="hfUsageHint">
                                                <span id="hfRemaining">200</span> calls remaining
                                            </div>
                                        </div>
                                        
                                        <!-- Gemini Usage -->
                                        <div class="model-usage-section">
                                            <div class="model-header">
                                                <i class="fas fa-stars"></i>
                                                <span class="model-name">Gemini 2.5 Flash</span>
                                            </div>
                                            <div class="usage-stats-row">
                                                <span class="usage-count">
                                                    <span id="geminiUsageCount">0</span> / <span id="geminiUsageLimit">10</span>
                                                </span>
                                                <span class="usage-percentage" id="geminiUsagePercentage">0%</span>
                                            </div>
                                            <div class="usage-progress-bar">
                                                <div class="usage-progress-fill" id="geminiProgressFill" style="width: 0%"></div>
                                            </div>
                                            <div class="usage-hint" id="geminiUsageHint">
                                                <span id="geminiRemaining">10</span> calls remaining
                                            </div>
                                        </div>
                                        
                                        <!-- Total Usage Stats -->
                                        <div class="total-usage-section">
                                            <div class="total-stat">
                                                <span class="stat-label">Total Lifetime</span>
                                                <span class="stat-value" id="totalLifetimeUsage">0</span>
                                            </div>
                                        </div>
                                    </div>
                                </sl-menu-item>
                                <sl-divider></sl-divider>
                                <sl-menu-item id="profilePictureMenuItem">
                                    <i class="fas fa-camera" slot="prefix"></i>
                                    <a href="/profile/upload" style="text-decoration: none; color: inherit; display: flex; align-items: center; width: 100%;">
                                        Profile Picture
                                    </a>
                                </sl-menu-item>
                                <sl-menu-item id="logoutMenuItem">
                                    <i class="fas fa-sign-out-alt" slot="prefix"></i>
                                    Logout
                                </sl-menu-item>
                            </sl-menu>
                        </sl-dropdown>
                        
                        <!-- Mobile burger toggle -->
                        <button class="menu-toggle" id="menuToggle" aria-label="Open menu" aria-controls="mobileNav">
                            <i class="fas fa-bars" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </nav>
            <!-- Mobile / Drawer navigation -->
            <sl-drawer id="mobileNav" placement="start" label="Menu">
                <nav class="drawer-links" aria-label="Main navigation">
                    <div class="drawer-section-label">Navigation</div>
                    <a href="#hero-section" class="nav-link"><i class="fas fa-home"></i><span>Home</span></a>
                    <a href="#main-content" class="nav-link"><i class="fas fa-magic"></i><span>Analyze</span></a>
                    <a href="/bug-report" class="nav-link"><i class="fas fa-bug"></i><span>Report Bug</span></a>
                    <a href="#about" class="nav-link" id="aboutLinkDrawer"><i class="fas fa-info-circle"></i><span>About</span></a>
                    <a href="#contact" class="nav-link"><i class="fas fa-envelope"></i><span>Contact</span></a>

                    <sl-divider></sl-divider>

                    <div class="drawer-section-label">Account</div>
                    <!-- Shown when NOT logged in -->
                    <button type="button" class="oauth-btn drawer-auth-btn" id="drawerLoginBtn">
                        <i class="fas fa-user"></i>
                        <span>Sign In</span>
                    </button>
                    <!-- Shown when logged in -->
                    <div class="drawer-account" id="drawerAccount" style="display:none;">
                        <div class="drawer-user">
                            <img id="drawerUserAvatar" class="user-avatar" alt="User avatar" />
                            <div class="drawer-user-meta">
                                <div id="drawerUserName" class="drawer-user-name">User</div>
                                <div class="drawer-usage"><span id="drawerUsageCount">0</span>/<span id="drawerUsageLimit">100</span> today</div>
                            </div>
                        </div>
                        <a href="/profile/upload" class="drawer-profile-btn" id="drawerProfileBtn">
                            <i class="fas fa-camera"></i>
                            <span>Profile Picture</span>
                        </a>
                        <button type="button" class="drawer-logout-btn" id="drawerLogoutBtn"><i class="fas fa-sign-out-alt"></i><span>Logout</span></button>
                    </div>

                    <sl-divider></sl-divider>

                    <div class="drawer-section-label">Utilities</div>
                    <button type="button" class="drawer-util-btn" id="drawerThemeToggle"><i class="fas fa-adjust"></i><span>Toggle Theme</span></button>
                    <a href="#examples" class="drawer-util-link"><i class="fas fa-code"></i><span>API Examples</span></a>
                    <a href="/bug-report" class="drawer-util-link"><i class="fas fa-comment-dots"></i><span>Send Feedback</span></a>

                    <sl-divider></sl-divider>

                    <div class="drawer-section-label">Legal</div>
                    <a href="#privacy" class="drawer-meta-link"><i class="fas fa-user-shield"></i><span>Privacy</span></a>
                    <a href="#terms" class="drawer-meta-link"><i class="fas fa-file-contract"></i><span>Terms</span></a>
                </nav>
            </sl-drawer>
            <div class="hero" id="hero-section" data-aos="fade-up">
                <canvas id="heroCanvas" class="hero-canvas" aria-hidden="true"></canvas>
                <div class="blob blob-1" aria-hidden="true"></div>
                <div class="blob blob-2" aria-hidden="true"></div>
                <div class="hero-inner">
                    <div class="hero-left">
                        <h2 class="hero-title">Protect your platform<br><span class="accent">with AI content analysis</span></h2>
                        <p class="hero-subtitle">Detect malicious language, hate speech, harassment, and threats in real time. Built for modern teenage communities.</p>
                        <div class="hero-cta">
                            <a href="#main-content" class="cta-primary">
                                <i class="fas fa-magic" aria-hidden="true"></i>
                                <span>Start Analyzing</span>
                            </a>
                            <a href="#examples" class="cta-secondary">
                                <i class="fas fa-icons" aria-hidden="true"></i>
                                <span>See Examples</span>
                            </a>
                        </div>
                        <div class="hero-stats">
                            <div class="stat">
                                <span class="stat-number">99.8%</span>
                                <span class="stat-label">Accuracy</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- API Examples Section (Moved from hero) -->
        <section class="examples-section" id="examples" data-aos="fade-up">
            <div class="container">
                <div class="section-header" style="text-align: center; margin-bottom: 3rem;">
                    <h2>API Examples</h2>
                    <p>See how easy it is to integrate ContentGuard AI into your application</p>
                </div>
                <div class="examples-content">
                    <!-- Interactive API Code Snippet -->
                    <div class="glass-card api-showcase" aria-label="API code examples">
                            <!-- Animated API Flow Visualization -->
                            <div class="api-flow-animation" id="apiFlowAnimation">
                                <div class="flow-step" data-step="1">
                                    <div class="flow-icon request">
                                        <i class="fas fa-paper-plane"></i>
                                    </div>
                                    <div class="flow-label">Request</div>
                                </div>
                                <div class="flow-arrow">
                                    <div class="arrow-line"></div>
                                    <div class="arrow-head"></div>
                                    <div class="data-packet"></div>
                                </div>
                                <div class="flow-step" data-step="2">
                                    <div class="flow-icon processing">
                                        <i class="fas fa-brain"></i>
                                    </div>
                                    <div class="flow-label">AI Analysis</div>
                                </div>
                                <div class="flow-arrow">
                                    <div class="arrow-line"></div>
                                    <div class="arrow-head"></div>
                                    <div class="data-packet"></div>
                                </div>
                                <div class="flow-step" data-step="3">
                                    <div class="flow-icon response">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="flow-label">Response</div>
                                </div>
                            </div>
                            
                            <div class="api-header">
                                <span class="api-title">Try Our API</span>
                                <button class="copy-btn" id="copyCodeBtn" aria-label="Copy code to clipboard">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            
                            <!-- Language Tabs -->
                            <div class="code-tabs" role="tablist" aria-label="Programming language selector">
                                <button class="code-tab active" data-lang="curl" role="tab" aria-selected="true" aria-controls="code-curl">
                                    <i class="fas fa-terminal"></i>
                                    <span>cURL</span>
                                </button>
                                <button class="code-tab" data-lang="python" role="tab" aria-selected="false" aria-controls="code-python">
                                    <i class="fab fa-python"></i>
                                    <span>Python</span>
                                </button>
                                <button class="code-tab" data-lang="javascript" role="tab" aria-selected="false" aria-controls="code-javascript">
                                    <i class="fab fa-js"></i>
                                    <span>JavaScript</span>
                                </button>
                                <button class="code-tab" data-lang="ruby" role="tab" aria-selected="false" aria-controls="code-ruby">
                                    <i class="fas fa-gem"></i>
                                    <span>Ruby</span>
                                </button>
                            </div>
                            
                            <!-- Code Panels -->
                            <div class="code-panels">
                                <div class="code-panel active" id="code-curl" role="tabpanel" aria-labelledby="tab-curl">
                                    <pre><code class="language-bash">curl -sS -X POST https://plankton-app-xj6ib.ondigitalocean.app/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "title": "test",
    "content": "you are stupid"
  }' | jq</code></pre>
                                </div>
                                <div class="code-panel" id="code-python" role="tabpanel" aria-labelledby="tab-python" hidden>
                                    <pre><code class="language-python">import requests

resp = requests.post(
    "https://plankton-app-xj6ib.ondigitalocean.app/analyze",
    headers={
        "Content-Type": "application/json"
    },
    json={
        "title": "test",
        "content": "you are stupid"
    },
    timeout=30
)
resp.raise_for_status()
result = resp.json()
print(result)</code></pre>
                                </div>
                                <div class="code-panel" id="code-javascript" role="tabpanel" aria-labelledby="tab-javascript" hidden>
                                    <pre><code class="language-javascript">const resp = await fetch('https://plankton-app-xj6ib.ondigitalocean.app/analyze', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    title: 'test',
    content: 'you are stupid'
  })
});
if (!resp.ok) throw new Error('Request failed');
const result = await resp.json();
console.log(result);</code></pre>
                                </div>
                                <div class="code-panel" id="code-ruby" role="tabpanel" aria-labelledby="tab-ruby" hidden>
                                    <pre><code class="language-ruby">require 'net/http'
require 'json'

uri = URI('https://plankton-app-xj6ib.ondigitalocean.app/analyze')
req = Net::HTTP::Post.new(uri)
req['Content-Type'] = 'application/json'
req.body = { title: 'test', content: 'you are stupid' }.to_json

resp = Net::HTTP.start(uri.hostname, uri.port, use_ssl: true) do |http|
  http.request(req)
end
raise "Request failed: #{resp.code}" unless resp.is_a?(Net::HTTPSuccess)
result = JSON.parse(resp.body)
puts result</code></pre>
                                </div>
                            </div>
                            
                            <!-- Response Preview -->
                            <div class="response-preview">
                                <div class="response-header">
                                    <span class="response-status">Response: <span class="status-code">200 OK</span></span>
                                    <span class="response-time">~250ms</span>
                                </div>
                                <pre><code class="language-json">{
  "is_malicious": false,
  "confidence": "94.2%",
  "analysis": "Content appears safe"
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <main class="main-content" id="main-content" role="main" data-aos="fade-up">
            <section class="input-section" aria-labelledby="analyze-heading">
                <div class="section-header">
                    <h2 id="analyze-heading">Analyze Your Content</h2>
                    <p>Enter a URL or text to detect malicious language, hate speech, harassment, or threats</p>
                </div>

                <!-- Anonymous User Usage Banner (shown when not logged in) -->
                <div id="anonymousUsageBanner" class="anonymous-usage-banner" style="display: none;">
                    <div class="banner-content">
                        <div class="banner-header">
                            <div class="banner-title">
                                <i class="fas fa-chart-bar"></i>
                                <span>Your API Usage Today</span>
                            </div>
                            <button class="banner-close" id="closeBannerBtn" aria-label="Close banner">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="banner-stats">
                            <!-- HuggingFace Usage -->
                            <div class="anon-model-section">
                                <div class="anon-model-header">
                                    <i class="fas fa-cpu"></i>
                                    <span class="anon-model-name">ContentGuard Model</span>
                                </div>
                                <div class="anon-usage-row">
                                    <span class="anon-usage-text">
                                        <span id="anonHfUsed">0</span> / <span id="anonHfLimit">100</span> calls used
                                    </span>
                                    <span class="anon-remaining" id="anonHfRemaining">100 remaining</span>
                                </div>
                                <div class="anon-progress-bar">
                                    <div class="anon-progress-fill" id="anonHfProgressFill" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <!-- Gemini Cooldown Info -->
                            <div class="anon-model-section" id="anonGeminiSection">
                                <div class="anon-model-header">
                                    <i class="fas fa-stars"></i>
                                    <span class="anon-model-name">Gemini Model</span>
                                </div>
                                <div class="anon-gemini-info" id="anonGeminiInfo">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Available with cooldown between requests</span>
                                </div>
                                <div class="anon-gemini-cooldown" id="anonGeminiCooldown" style="display: none;">
                                    <i class="fas fa-clock"></i>
                                    <span>Cooldown active: <strong id="anonCooldownTime">--</strong></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="banner-cta">
                            <div class="cta-content">
                                <div class="cta-text">
                                    <i class="fas fa-rocket"></i>
                                    <div>
                                        <strong>Want more?</strong>
                                        <span>Sign up for 200 ContentGuard + 10 Gemini calls per day!</span>
                                    </div>
                                </div>
                                <div class="cta-buttons">
                                    <a href="/auth/signup" class="cta-btn primary">
                                        <i class="fas fa-user-plus"></i>
                                        <span>Sign Up Free</span>
                                    </a>
                                    <a href="/auth/login" class="cta-btn secondary">
                                        <i class="fas fa-sign-in-alt"></i>
                                        <span>Sign In</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Mode Toggle -->
                <div class="input-mode-toggle" role="tablist" aria-label="Input mode selection">
                    <button
                        type="button"
                        class="toggle-btn active"
                        id="urlModeBtn"
                        role="tab"
                        aria-selected="true"
                        aria-controls="urlInputSection"
                    >
                        <i class="fas fa-link" aria-hidden="true"></i>
                        <span>URL Analysis</span>
                    </button>
                    <button
                        type="button"
                        class="toggle-btn"
                        id="manualModeBtn"
                        role="tab"
                        aria-selected="false"
                        aria-controls="manualInputSection"
                    >
                        <i class="fas fa-keyboard" aria-hidden="true"></i>
                        <span>Manual Input</span>
                    </button>
                </div>

                <!-- URL Input Section (Default) -->
                <div id="urlInputSection" class="input-mode-content active" role="tabpanel" aria-labelledby="urlModeBtn">
                    <form id="urlAnalysisForm" class="analysis-form" role="form" aria-label="URL analysis form">
                        <div class="form-group">
                            <label for="url">Social Media URL <span aria-label="required">*</span></label>
                            <sl-input
                                id="url"
                                name="url"
                                type="url"
                                placeholder="https://reddit.com/r/.../comments/..."
                                required
                                aria-describedby="url-help"
                            ></sl-input>
                            <div id="url-help" class="input-help">
                                <i class="fas fa-info-circle"></i>
                                <span>Currently supports Reddit posts. Paste a Reddit post URL to analyze the post and comments.</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="urlModelSelect">AI Model <span aria-label="required">*</span></label>
                            <sl-select
                                id="urlModelSelect"
                                name="model"
                                value="gemini"
                                aria-describedby="url-model-help"
                            >
                                <sl-option value="gemini">
                                    <sl-icon slot="prefix" name="stars"></sl-icon>
                                    Gemini 2.5 Flash (Finetuned) - 10 calls/day
                                </sl-option>
                                <sl-option value="huggingface">
                                    <sl-icon slot="prefix" name="cpu"></sl-icon>
                                    ContentGuard Model (Free) - 200 calls/day
                                </sl-option>
                            </sl-select>
                            <div id="url-model-help" class="input-help">
                                <i class="fas fa-info-circle"></i>
                                <span>Choose the AI model for content analysis. Gemini offers enhanced accuracy with limited daily usage.</span>
                            </div>
                        </div>

                        <div class="form-actions">
                            <sl-button type="submit" class="analyze-btn" variant="primary" size="large">
                                <i class="fas fa-search" aria-hidden="true"></i>
                                <span>Analyze URL</span>
                            </sl-button>
                        </div>

                        <div class="example-actions" aria-describedby="url-examples-help">
                            <button type="button" class="example-btn" id="exampleRedditBtn">
                                <i class="fab fa-reddit" aria-hidden="true"></i>
                                <span>Reddit Example</span>
                            </button>
                        </div>
                        <div id="url-examples-help" class="sr-only">Use the example button to prefill with a sample Reddit URL.</div>
                    </form>
                </div>

                <!-- Manual Input Section (Hidden by default) -->
                <div id="manualInputSection" class="input-mode-content" role="tabpanel" aria-labelledby="manualModeBtn" style="display: none;">
                    <form id="analysisForm" class="analysis-form" role="form" aria-label="Content analysis form">
                        <div class="form-group">
                            <label for="title">Title (Optional)</label>
                            <sl-input
                                id="title"
                                name="title"
                                placeholder="Enter post title..."
                                aria-describedby="title-help"
                            ></sl-input>
                            <div id="title-help" class="sr-only">Optional title for context</div>
                        </div>

                        <div class="form-group">
                            <label for="content">Content <span aria-label="required">*</span></label>
                            <sl-textarea
                                id="content"
                                name="content"
                                rows="6"
                                placeholder="Enter the content you want to analyze..."
                                required
                                aria-describedby="content-help content-counter"
                                maxlength="5000"
                            ></sl-textarea>
                            <div id="content-help" class="sr-only">Required content to analyze for malicious language</div>
                            <div class="char-counter" id="content-counter" aria-live="polite">
                                <span class="char-count">0 characters</span>
                                <div class="progress">
                                    <div class="progress-bar" style="width: 0%"></div>
                                </div>
                                <span class="char-limit">/ 5000</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="modelSelect">AI Model <span aria-label="required">*</span></label>
                            <sl-select
                                id="modelSelect"
                                name="model"
                                value="gemini"
                                aria-describedby="model-help"
                            >
                                <sl-option value="gemini">
                                    <sl-icon slot="prefix" name="stars"></sl-icon>
                                    Gemini 2.5 Flash (Finetuned) - 10 calls/day
                                </sl-option>
                                <sl-option value="huggingface">
                                    <sl-icon slot="prefix" name="cpu"></sl-icon>
                                    ContentGuard Model (Free) - 200 calls/day
                                </sl-option>
                            </sl-select>
                            <div id="model-help" class="input-help">
                                <i class="fas fa-info-circle"></i>
                                <span>Choose the AI model for content analysis. Gemini offers enhanced accuracy with limited daily usage.</span>
                            </div>
                        </div>

                        <div class="form-actions">
                            <sl-button type="submit" class="analyze-btn" variant="primary" size="large" aria-describedby="submit-help">
                                <i class="fas fa-search" aria-hidden="true"></i>
                                <span>Analyze Content</span>
                            </sl-button>
                        </div>

                        <div class="example-actions" aria-describedby="examples-help">
                            <button type="button" class="example-btn safe" id="exampleSafeBtn">
                                <i class="fas fa-thumbs-up" aria-hidden="true"></i>
                                <span>Safe Example</span>
                            </button>
                            <button type="button" class="example-btn malicious" id="exampleMaliciousBtn">
                                <i class="fas fa-exclamation" aria-hidden="true"></i>
                                <span>Malicious Example</span>
                            </button>
                        </div>
                        <div id="examples-help" class="sr-only">Use the Safe or Malicious example to prefill the form.</div>
                    </form>
                </div>
            </section>

            <section class="results-section" id="resultsSection" style="display: none;" aria-labelledby="results-heading" role="region" aria-live="polite" data-aos="fade-up">
                <h2 id="results-heading">Analysis Results</h2>
                <!-- Skeleton Loading Card (Shoelace) -->
                <div class="result-card skeleton" id="skeletonCard" style="display: none;" aria-hidden="true">
                    <div style="display:flex; gap:12px; align-items:center;">
                        <sl-skeleton effect="pulse" style="--width:48px; --height:48px; border-radius:50%;"></sl-skeleton>
                        <div style="flex:1">
                            <sl-skeleton effect="pulse" style="--width:40%; --height:16px;"></sl-skeleton>
                            <sl-skeleton effect="pulse" style="--width:60%; --height:12px; margin-top:8px;"></sl-skeleton>
                        </div>
                    </div>
                    <div style="margin-top:12px; display:grid; gap:8px;">
                        <sl-skeleton effect="pulse"></sl-skeleton>
                        <sl-skeleton effect="pulse"></sl-skeleton>
                        <sl-skeleton effect="pulse"></sl-skeleton>
                        <sl-skeleton effect="pulse"></sl-skeleton>
                        <sl-skeleton effect="pulse"></sl-skeleton>
                    </div>
                </div>

                <div class="result-card" id="resultCard" data-aos="fade-up">
                    <div class="result-header">
                        <div class="status-indicator" id="statusIndicator" role="img" aria-label="Analysis status">
                            <i class="fas fa-question-circle" aria-hidden="true"></i>
                        </div>
                        <div class="result-info">
                            <h3 id="resultTitle">Analyzing...</h3>
                            <p id="resultSubtitle">Processing your content</p>
                            <sl-badge id="riskBadge" variant="neutral" aria-live="polite" data-tippy-content="Current risk classification">Pending</sl-badge>
                        </div>
                    </div>
                    
                    <div class="result-details" role="list">
                        <div class="detail-item" role="listitem">
                            <span class="label">Analysis:</span>
                            <span class="value" id="analysisText">-</span>
                        </div>
                        <div class="detail-item" role="listitem">
                            <span class="label">Confidence:</span>
                            <span class="value" id="confidenceText">-</span>
                        </div>
                        <div class="detail-item" role="listitem">
                            <span class="label">Risk Level:</span>
                            <span class="value" id="riskLevelText">-</span>
                        </div>
                        <div class="detail-item" role="listitem">
                            <span class="label">Elements Scanned:</span>
                            <span class="value" id="elementsScannedText">-</span>
                        </div>
                        <div class="detail-item" role="listitem">
                            <span class="label">Timestamp:</span>
                            <span class="value" id="timestampText">-</span>
                        </div>
                    </div>

                    <!-- Probability bars -->
                    <div class="probability-section" id="probabilitySection" aria-label="Classification Probabilities">
                        <div class="prob-row">
                            <span class="prob-label">Safe</span>
                            <sl-progress-bar id="safeBar" value="0" style="--height: 10px"></sl-progress-bar>
                            <span class="prob-value" id="safeValue">0%</span>
                        </div>
                        <div class="prob-row">
                            <span class="prob-label">Malicious</span>
                            <sl-progress-bar id="maliciousBar" value="0" style="--height: 10px"></sl-progress-bar>
                            <span class="prob-value" id="maliciousValue">0%</span>
                        </div>
                    </div>
                    
                    <!-- Explainability Section -->
                    <div id="explainabilityContainer" class="explainability-container"></div>
                </div>

                <!-- Detailed Analysis Toggle & Section -->
                <button class="details-toggle" id="detailsToggle" aria-expanded="false" aria-controls="detailedAnalysis" data-tippy-content="Show detailed breakdown">
                    <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    <span>Show details</span>
                </button>
                <div class="detailed-analysis" id="detailedAnalysis" style="display: none;" aria-labelledby="detailed-heading" data-aos="fade-up">
                    <h3 id="detailed-heading">Detailed Analysis</h3>
                    <sl-tab-group id="detailsTabs">
                        <sl-tab slot="nav" panel="overview">Overview</sl-tab>
                        <sl-tab slot="nav" panel="risk">Risk Categories</sl-tab>
                        <sl-tab slot="nav" panel="positives">Positives</sl-tab>
                        <sl-tab slot="nav" panel="explanation">Explanation</sl-tab>

                        <sl-tab-panel name="overview">
                            <p id="overviewText">Summary and key signals appear here after analysis.</p>
                        </sl-tab-panel>

                        <sl-tab-panel name="risk">
                            <div class="category-list" id="riskCategoriesList" role="list"></div>
                        </sl-tab-panel>

                        <sl-tab-panel name="positives">
                            <div class="category-list" id="positiveElementsList" role="list"></div>
                        </sl-tab-panel>

                        <sl-tab-panel name="explanation">
                            <div class="explanation-text" id="explanationText"></div>
                        </sl-tab-panel>
                    </sl-tab-group>
                </div>
            </section>

            <!-- URL Analysis Results Section -->
            <section class="url-results-section" id="urlResultsSection" style="display: none;" aria-labelledby="url-results-heading" role="region" aria-live="polite" data-aos="fade-up">
                <h2 id="url-results-heading">URL Analysis Results</h2>

                <!-- Analysis Status Banner -->
                <div id="analysisStatusBanner" style="display: none;"></div>

                <!-- Modern Progress Animation with Motion.js -->
                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-animation-wrapper">
                        <div class="motion-animation" id="motionAnimation">
                            <svg width="150" height="150" viewBox="0 0 150 150">
                                <!-- Background circle -->
                                <circle class="motion-circle-bg" cx="75" cy="75" r="60"
                                    fill="none" stroke="currentColor" stroke-width="8" opacity="0.15"/>
                                <!-- Animated progress circle -->
                                <circle class="motion-circle-progress" cx="75" cy="75" r="60"
                                    fill="none" stroke="url(#progressGradient)" stroke-width="8"
                                    stroke-linecap="round" stroke-dasharray="377" stroke-dashoffset="377"
                                    transform="rotate(-90 75 75)"/>
                                <!-- Gradient definition -->
                                <defs>
                                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                        <stop offset="50%" style="stop-color:#764ba2;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#f093fb;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="motion-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                        </div>
                    </div>
                    <div class="progress-header">
                        <div class="progress-status">
                            <span class="progress-text" id="progressText">Initializing...</span>
                        </div>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                    <sl-progress-bar
                        id="urlProgressBar"
                        value="0"
                        style="--height: 8px; --indicator-color: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);"
                    ></sl-progress-bar>
                    <div class="progress-details" id="progressDetails">
                        <span class="detail-item"><i class="fas fa-globe"></i> Scraping: <span id="scrapingStatus">Pending</span></span>
                        <span class="detail-item"><i class="fas fa-file-alt"></i> Post: <span id="postStatus">Pending</span></span>
                        <span class="detail-item"><i class="fas fa-comments"></i> Comments: <span id="commentsStatus">0/0</span></span>
                    </div>
                </div>

                <!-- Summary Banner -->
                <div class="summary-banner" id="summaryBanner">
                    <div class="summary-stats">
                        <div class="stat-item">
                            <i class="fas fa-chart-line" aria-hidden="true"></i>
                            <span class="stat-label">Total Analyzed:</span>
                            <span class="stat-value" id="totalAnalyzed">0</span>
                        </div>
                        <div class="stat-item safe">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                            <span class="stat-label">Safe:</span>
                            <span class="stat-value" id="safeCount">0</span>
                        </div>
                        <div class="stat-item malicious">
                            <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                            <span class="stat-label">Malicious:</span>
                            <span class="stat-value" id="maliciousCount">0</span>
                        </div>
                    </div>
                    <div class="cache-indicator" id="cacheIndicator" style="display: none;">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        <span>Cached result</span>
                    </div>
                </div>

                <!-- Post Analysis Card -->
                <div class="url-result-card post-card" id="postCard">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fab fa-reddit" aria-hidden="true"></i>
                            <h3>Post</h3>
                        </div>
                        <sl-badge id="postRiskBadge" variant="neutral">Analyzing...</sl-badge>
                    </div>
                    <div class="card-content">
                        <h4 id="postTitle" class="post-title">Loading...</h4>
                        <p id="postContent" class="post-content">Loading...</p>
                        <div class="post-meta">
                            <span><i class="fas fa-user"></i> <span id="postAuthor">...</span></span>
                            <span><i class="fas fa-arrow-up"></i> <span id="postScore">0</span></span>
                        </div>
                    </div>
                    <div class="card-analysis">
                        <div class="analysis-item">
                            <span class="label">Confidence:</span>
                            <span class="value" id="postConfidence">-</span>
                        </div>
                        <div class="analysis-item">
                            <span class="label">Analysis:</span>
                            <span class="value" id="postAnalysis">-</span>
                        </div>
                    </div>
                </div>

                <!-- Comments Section -->
                <div class="comments-section" id="commentsSection">
                    <div class="comments-header">
                        <h3><i class="fas fa-comments" aria-hidden="true"></i> Comments (<span id="commentsCount">0</span>)</h3>
                        <button class="filter-btn" id="filterMaliciousBtn" aria-pressed="false">
                            <i class="fas fa-filter"></i>
                            <span>Show malicious only</span>
                        </button>
                    </div>
                    <div class="comments-list" id="commentsList">
                        <!-- Comments will be dynamically inserted here -->
                    </div>
                    <div class="truncated-notice" id="truncatedNotice" style="display: none;">
                        <i class="fas fa-info-circle"></i>
                        <span>Showing <span id="extractedCount">20</span> of <span id="totalCommentsCount">100</span> total comments</span>
                    </div>
                </div>
            </section>

            <section class="error-section" id="errorSection" style="display: none;" aria-labelledby="error-heading" role="alert" aria-live="assertive">
                <h2 id="error-heading" class="sr-only">Error</h2>
                <sl-alert id="errorAlert" variant="danger">
                    <sl-icon slot="icon" name="exclamation-triangle"></sl-icon>
                    <strong>Error</strong><br />
                    <span id="errorMessage">Something went wrong</span>
                </sl-alert>
            </section>

        </main>

        <section class="features-section" id="about" data-aos="fade-up">
            <div class="container">
                <h2>Why Choose ContentGuard AI?</h2>
                <div class="features-grid">
                    <div class="feature-card" data-aos="zoom-in" data-aos-delay="50" data-tippy="Advanced AI" data-tippy-placement="top">
                        <i class="fas fa-brain" aria-hidden="true"></i>
                        <h3>Advanced AI</h3>
                        <p>Powered by state-of-the-art language models trained on Gen Z communication patterns</p>
                    </div>
                    <div class="feature-card" data-aos="zoom-in" data-aos-delay="100" data-tippy="Real-time Detection" data-tippy-placement="top">
                        <i class="fas fa-bolt" aria-hidden="true"></i>
                        <h3>Real-time Detection</h3>
                        <p>Instant analysis with detailed breakdowns for transparency and trust</p>
                    </div>
                    <div class="feature-card" data-aos="zoom-in" data-aos-delay="150" data-tippy="Mobile Optimized" data-tippy-placement="top">
                        <i class="fas fa-mobile-alt" aria-hidden="true"></i>
                        <h3>Mobile Optimized</h3>
                        <p>Responsive design that works seamlessly across all devices</p>
                    </div>
                    <div class="feature-card" data-aos="zoom-in" data-aos-delay="200" data-tippy="Privacy First" data-tippy-placement="top">
                        <i class="fas fa-lock" aria-hidden="true"></i>
                        <h3>Privacy First</h3>
                        <p>Your content is processed securely and never stored permanently</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="footer" role="contentinfo" id="contact">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>ContentGuard AI</h3>
                        <p>Protecting digital spaces with intelligent content analysis</p>
                    </div>
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="#main-content">Analyze Content</a></li>
                            <li><a href="#about">About</a></li>
                            <li><a href="#contact">Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Contact</h4>
                        <p>Email: info@contentguard-ai.com</p>
                        <p>Follow us on social media</p>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2024 ContentGuard AI. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Screen reader only class -->
    <style>
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>

    

    <!-- Login Modal -->
    <sl-dialog label="Sign In to ContentGuard AI" id="loginDialog" class="auth-dialog">
        <div class="auth-dialog-content">
            <p class="auth-subtitle">Choose your preferred sign-in method</p>
            
            <div class="oauth-buttons">
                <!-- Google OAuth Button -->
                <a href="/auth/login/google" class="oauth-btn google-btn">
                    <svg class="oauth-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>Continue with Google</span>
                </a>
                
                <!-- GitHub OAuth Button -->
                <a href="/auth/login/github" class="oauth-btn github-btn">
                    <i class="fab fa-github oauth-icon"></i>
                    <span>Continue with GitHub</span>
                </a>
            </div>
            
            <div class="auth-benefits">
                <h4>Benefits of signing in:</h4>
                <ul>
                    <li><i class="fas fa-check-circle"></i> Track your API usage</li>
                    <li><i class="fas fa-check-circle"></i> 100 free API calls per day</li>
                    <li><i class="fas fa-check-circle"></i> Save analysis history</li>
                    <li><i class="fas fa-check-circle"></i> Priority support</li>
                </ul>
            </div>
            
            <p class="auth-privacy">
                <i class="fas fa-lock"></i>
                We respect your privacy. We only access your basic profile information.
            </p>
        </div>
    </sl-dialog>

    <!-- Toast container (Shoelace alerts will be appended here) -->
    <div id="toastContainer" style="position: fixed; top: 16px; right: 16px; z-index: 9999;"></div>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top" aria-label="Back to top" title="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="{{ url_for('static', filename='js/explainability-ui.js') }}"></script>
    
    <!-- Rate Limit Handler - Inline to avoid caching issues -->
    <script>
    class RateLimitHandler {
        constructor() {
            this.cooldownEndTime = null;
            this.timerInterval = null;
            this.analyzeBtn = document.querySelector('.analyze-btn');
            this.rateLimitDisplay = null;
            this.createRateLimitDisplay();
        }

        createRateLimitDisplay() {
            const form = document.getElementById('analysisForm');
            if (!form) return;

            this.rateLimitDisplay = document.createElement('div');
            this.rateLimitDisplay.id = 'rateLimitDisplay';
            this.rateLimitDisplay.className = 'rate-limit-display';
            this.rateLimitDisplay.style.display = 'none';
            
            const buttonContainer = this.analyzeBtn?.parentElement;
            if (buttonContainer && this.analyzeBtn) {
                buttonContainer.insertBefore(this.rateLimitDisplay, this.analyzeBtn);
            }
        }

        handleRateLimitError(errorData) {
            if (errorData.seconds_remaining) {
                this.startCooldown(errorData.seconds_remaining);
                this.showError(errorData.hint || errorData.error, errorData);
            }
        }

        startCooldown(seconds) {
            this.cooldownEndTime = Date.now() + (seconds * 1000);
            
            if (this.analyzeBtn) {
                this.analyzeBtn.disabled = true;
            }
            
            this.updateTimer();
            this.timerInterval = setInterval(() => this.updateTimer(), 1000);
        }

        updateTimer() {
            if (!this.cooldownEndTime) return;

            const now = Date.now();
            const remaining = Math.max(0, Math.ceil((this.cooldownEndTime - now) / 1000));

            if (remaining <= 0) {
                this.endCooldown();
                return;
            }

            const minutes = Math.floor(remaining / 60);
            const seconds = remaining % 60;
            const timeStr = minutes > 0 ? `${minutes}m ${seconds}s` : `${seconds}s`;

            if (this.rateLimitDisplay) {
                this.rateLimitDisplay.style.display = 'block';
                this.rateLimitDisplay.innerHTML = `
                    <div class="cooldown-timer">
                        <i class="fas fa-clock"></i>
                        <span>Gemini API cooldown: <strong>${timeStr}</strong> remaining</span>
                        <small>Sign in to remove cooldowns</small>
                    </div>
                `;
            }

            if (this.analyzeBtn) {
                this.analyzeBtn.innerHTML = `
                    <i class="fas fa-clock"></i>
                    <span>Cooldown: ${timeStr}</span>
                `;
            }
        }

        endCooldown() {
            if (this.timerInterval) {
                clearInterval(this.timerInterval);
                this.timerInterval = null;
            }
            this.cooldownEndTime = null;

            if (this.rateLimitDisplay) {
                this.rateLimitDisplay.style.display = 'none';
            }

            if (this.analyzeBtn) {
                this.analyzeBtn.disabled = false;
                this.analyzeBtn.innerHTML = `
                    <i class="fas fa-shield-alt"></i>
                    <span>Analyze Content</span>
                `;
            }
        }

        showError(message, errorData) {
            const errorSection = document.getElementById('errorSection');
            if (!errorSection) return;

            errorSection.style.display = 'block';
            errorSection.innerHTML = `
                <div class="error-content">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>Rate Limit Active</h3>
                    <p>${message}</p>
                    ${errorData.actions ? `
                        <div class="error-actions">
                            <a href="${errorData.actions.login}" class="btn btn-primary">Sign In</a>
                            <a href="${errorData.actions.signup}" class="btn btn-secondary">Sign Up</a>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        displayRateLimitInfo(rateLimitData) {
            if (!rateLimitData) return;

            const info = [];
            
            if (rateLimitData.user_remaining !== undefined) {
                info.push(`${rateLimitData.user_remaining}/${rateLimitData.user_limit} calls remaining today`);
            }
            
            if (rateLimitData.global_remaining !== undefined) {
                info.push(`${rateLimitData.global_remaining}/${rateLimitData.global_limit} global calls remaining`);
            }

            if (info.length > 0 && this.rateLimitDisplay) {
                this.rateLimitDisplay.style.display = 'block';
                this.rateLimitDisplay.innerHTML = `
                    <div class="rate-limit-info">
                        <i class="fas fa-info-circle"></i>
                        <span>${info.join('  ')}</span>
                    </div>
                `;
            }
        }
    }

    window.RateLimitHandler = RateLimitHandler;
    console.log(' RateLimitHandler loaded inline');
    </script>
    
    <!-- Analysis Status Display -->
    <script>
    function displayAnalysisStatus(analysisStatus) {
        if (!analysisStatus) return;
        
        const banner = document.getElementById('analysisStatusBanner');
        if (!banner) return;
        
        // Determine banner type
        let bannerType = 'success';
        let icon = 'fa-check-circle';
        let title = 'Analysis Complete';
        
        if (analysisStatus.rate_limit_hit) {
            bannerType = 'error';
            icon = 'fa-exclamation-triangle';
            title = 'Rate Limit Reached';
        } else if (analysisStatus.partial_results) {
            bannerType = 'warning';
            icon = 'fa-exclamation-circle';
            title = 'Partial Analysis Complete';
        } else if (analysisStatus.method === 'fallback') {
            bannerType = 'warning';
            icon = 'fa-info-circle';
            title = 'Analysis Complete (Fallback Mode)';
        }
        
        // Build banner HTML
        banner.className = `analysis-status-banner ${bannerType}`;
        banner.innerHTML = `
            <div class="icon">
                <i class="fas ${icon}"></i>
            </div>
            <div class="content">
                <div class="title">${title}</div>
                <div class="message">${analysisStatus.message}</div>
            </div>
            <div class="badge ${analysisStatus.method}">
                ${analysisStatus.method === 'batch' ? 'Batch' : 'Individual'} Analysis
            </div>
        `;
        
        banner.style.display = 'flex';
        
        // Add additional info if rate limit hit
        if (analysisStatus.rate_limit_hit) {
            const handler = window.rateLimitHandler || getRateLimitHandler();
            if (handler && handler.rateLimitDisplay) {
                // Rate limit display will show cooldown timer
                console.log('Rate limit hit - cooldown timer should be visible');
            }
        }
    }
    
    window.displayAnalysisStatus = displayAnalysisStatus;
    console.log(' Analysis status display loaded');
    </script>
    
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/modern-animations.js') }}"></script>
</body>
</html>
